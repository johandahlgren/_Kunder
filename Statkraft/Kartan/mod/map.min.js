Statkraft.map=function(){function m(){var e=$("footer").height()+25,t=$(window).height();$(window).scroll(function(){debounce(function(){$(window).scrollTop()+t>=d()-e&&(c<Statkraft.mapProjects.length?c+8>Statkraft.mapProjects.length?(c-=c-Statkraft.mapProjects.length,g(c,"scroll")):(c+=8,$(".load-more-projects-container").removeClass("hidden"),$(".load-more-projects").removeClass("hidden"),g(c,"scroll"),$(".load-more-projects-container").addClass("hidden"),$(".load-more-projects").addClass("hidden")):($(".load-more-projects-container").removeClass("hidden"),$(".no-more-loading").removeClass("hidden")))},200,"map")})}function d(){var e=document;return Math.max(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight),Math.max(e.body.offsetHeight,e.documentElement.offsetHeight),Math.max(e.body.clientHeight,e.documentElement.clientHeight))}function g(e,t){void 0==e&&(e=8);for(var a=$(".type-checkbox.unchecked"),o=new Array,i=0;i<a.length;i++)o.push($(a[i]).attr("type"));for(var n=[],p=0;p<Statkraft.mapProjects.length;p++){var l=Statkraft.mapProjects[p],m=$("#map-search").val();if(""!==m){var d=new RegExp("."+m+".","i");d.test(l.MapProjectName)&&n.push(l)}else{$("#map-country-select .type-checkbox.checked").each(function(e,t){selectedCountries.push($(t).attr("data-text"))}),$("#map-energy-source-select .type-checkbox.checked").each(function(e,t){selectedSources.push($(t).attr("data-text"))});for(var g in Statkraft.Markers)-1!=$.inArray(Statkraft.Markers[g].type,selectedSources)&&-1!=$.inArray(Statkraft.Markers[g].country,selectedCountries)&&n.push(l)}}var h=$(".project-list"),f=0;"scroll"===t?f=h.find("li").length:h.empty();for(var v=f;e>v&&v<n.length;v++){var k=n[v];$(h).append('<li><div class="project-item '+k.MapPointType.toLowerCase().replace(" ","-")+'"><a href="'+k.MapProjectUrl+'" projecttype="'+k.MapPointType+'" projectname="'+k.MapProjectName+'" mapFacts="'+k.MapProjectFacts+'" data-id="'+k.MapProjectPageLink+'" data-image="'+k.ImageUrl+'" data-image-alt="'+k.ImageAltText+'" data-projectlink-text="'+k.MapProjectLinkText+'"><span class="project-item-row"><span class="project-item-cell project-item-image-cell"><img src="'+k.ImageUrl+'?width=320&amp;height=214&amp;mode=crop&amp;scale=both" alt="'+k.ImageAltText+'"/></span><span class="project-item-cell project-item-title-cell"><p class="'+k.MapPointType.toLowerCase().replace(" ","-")+'-item header"><span class="cell">'+k.MapProjectTranslateText+'</span></p><p class="project-country">'+k.MapProjectCountry+"</p><h3>"+k.MapProjectName+'</h3></span><span class="project-item-cell project-item-button-cell"><span class="marker"></span></span></span><p class="project-list-exerpt">'+k.MapProjectExcerptWithFallBack+"</p></a></div></li>")}$(".listview").hasClass("active")&&$(".project-list-exerpt").show(),u(),c=h.find("li").length}function h(n){n.preventDefault(),$(".mapFactsBox").removeClass("box-is-open").addClass("box-is-closed"),$(".mapFactsBox").hide(),$(".project-item.active").removeClass("active"),void 0!=e&&("Hydropower"==e.type&&e.setIcon(a),"Wind power"==e.type&&e.setIcon(t),"District heating"==e.type&&e.setIcon(o),"Gas power"==e.type&&e.setIcon(i))}function f(){$(".type-checkbox").each(function(){$(this).append($(this).attr("data-text"))})}function u(){var e=$(".project-list").find("li").filter(function(e,t){return"none"!==$(t).css("display")});e.removeClass("fourth-item third-item"),e.each(function(e,t){e++,0===e||e%4!==0||$(".project-list").hasClass("big-grid")?0!==e&&e%3===0&&$(".project-list").hasClass("big-grid")&&$(t).addClass("third-item"):$(t).addClass("fourth-item")}),toggleMobileExerpts()}function v(){t={url:"/Content/images/map-markers/wind-small.png",size:new google.maps.Size(26,26),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(13,13)},a={url:"/Content/images/map-markers/water-small.png",size:new google.maps.Size(26,26),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(13,13)},o={url:"/Content/images/map-markers/heating-small.png",size:new google.maps.Size(25,25),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(12,12)},i={url:"/Content/images/map-markers/gas-small.png",size:new google.maps.Size(25,25),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(12,12)},n={url:"/Content/images/map-markers/water-big.png",size:new google.maps.Size(50,50),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(25,25)},r={url:"/Content/images/map-markers/wind-big.png",size:new google.maps.Size(50,50),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(25,25)},s={url:"/Content/images/map-markers/heating-big.png",size:new google.maps.Size(50,50),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(25,25)},p={url:"/Content/images/map-markers/gas-big.png",size:new google.maps.Size(50,50),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(25,25)}}function k(){var e=$(".mapFactsBox"),t=$(".project-list");$(".mapview").click(function(){return $("#BigMap").show(),t.removeClass("big-grid"),$(".third-item").removeClass(),$("li:nth-child(4n)",t).addClass("fourth-item"),$(".mapview").addClass("active"),$(".listview").removeClass("active"),e.hasClass("box-is-open")&&e.show(),!1}),$(".listview").click(function(){return $("#BigMap").hide(),t.addClass("big-grid"),$(".fourth-item").removeClass(),$("li:nth-child(3n)",t).addClass("third-item"),$(".listview").addClass("active"),$(".mapview").removeClass("active"),e.hasClass("box-is-open")&&e.hide(),!1})}function w(){for(var c in Statkraft.Markers){var l=Statkraft.Markers[c];google.maps.event.addListener(l,"click",function(){void 0!=e&&("Hydropower"==e.type&&e.setIcon(a),"Wind power"==e.type&&e.setIcon(t),"District heating"==e.type&&e.setIcon(o),"Gas power"==e.type&&e.setIcon(i)),"Hydropower"==this.type&&this.setIcon(n),"Wind power"==this.type&&this.setIcon(r),"District heating"==this.type&&this.setIcon(s),"Gas power"==this.type&&this.setIcon(p),e=this,window.markerX=e;var c=$(".mapFactsBox");c.empty();var l=$(".project-list").find("a").filter(function(t,a){return $(a).data("id")==e.pageId});c.prepend('<div class="fact-projectlink-container"><a class="fact-projectlink" href="'+e.point.MapProjectUrl+'" >'+e.point.MapProjectLinkText+"</a></div>"),c.prepend('<div class="fact-mainbody"><h2>'+e.point.MapProjectName+"</h2>"+$("<div/>").html(e.point.MapProjectFacts).text()+"</div>"),$(".project-item.active").removeClass("active"),$(l).parent(".project-item").addClass("active"),c.prepend('<img class="fact-image '+e.point.MapPointType.toLowerCase().replace(" ","-")+'" src="'+e.point.ImageUrl+'?width=322&height=214&mode=crop&scale=both" alt="'+e.point.ImageAltText+'"></img>'),c.prepend('<a href="#" class="factbox-close"></a>'),c.show(),c.removeClass("box-is-closed").addClass("box-is-open"),$(".factbox-close").click(h)})}}function y(){var e={scrollwheel:!1,zoom:Statkraft.mapSettings.Zoom,minZoom:2,center:new google.maps.LatLng(Statkraft.mapSettings.Center.Latitude,Statkraft.mapSettings.Center.Longitude),mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.SATELLITE,"map_style"]}},t=new google.maps.Map(document.getElementById("BigMap"),e),a=new google.maps.StyledMapType(Statkraft.mapFunctions.mapStyle(),{name:"Map"});t.mapTypes.set("map_style",a),t.setMapTypeId("map_style"),Statkraft.Markers=[];for(var o in Statkraft.mapSettings.points)"Wind power"===Statkraft.mapSettings.points[o].MapPointType?P(Statkraft.mapSettings.points[o],t):"Hydropower"===Statkraft.mapSettings.points[o].MapPointType?M(Statkraft.mapSettings.points[o],t):"District heating"===Statkraft.mapSettings.points[o].MapPointType?j(Statkraft.mapSettings.points[o],t):"Gas power"===Statkraft.mapSettings.points[o].MapPointType&&S(Statkraft.mapSettings.points[o],t)}function C(e){for(var t=0;t<Statkraft.mapProjects.length;t++)if(Statkraft.mapProjects[t].MapProjectPageLink==e.PageId)return Statkraft.mapProjects[t]}function P(e,a){var o=new google.maps.Marker({position:new google.maps.LatLng(e.Coordinate.Latitude,e.Coordinate.Longitude),map:a,icon:t,animation:google.maps.Animation.DROP,title:e.Name,type:"Wind power",point:C(e)});o.pageId=e.PageId,Statkraft.Markers.push(o)}function M(e,t){var o=new google.maps.Marker({position:new google.maps.LatLng(e.Coordinate.Latitude,e.Coordinate.Longitude),map:t,icon:a,animation:google.maps.Animation.DROP,title:e.Name,type:"Hydropower",point:C(e)});o.pageId=e.PageId,Statkraft.Markers.push(o)}function j(e,t){var a=new google.maps.Marker({position:new google.maps.LatLng(e.Coordinate.Latitude,e.Coordinate.Longitude),map:t,icon:o,animation:google.maps.Animation.DROP,title:e.Name,type:"District heating",point:C(e)});a.pageId=e.PageId,Statkraft.Markers.push(a)}function S(e,t){var a=new google.maps.Marker({position:new google.maps.LatLng(e.Coordinate.Latitude,e.Coordinate.Longitude),map:t,icon:i,animation:google.maps.Animation.DROP,title:e.Name,type:"Gas power",point:C(e)});a.pageId=e.PageId,Statkraft.Markers.push(a)}function x(e){e.preventDefault(),$(".load-more-projects-container").addClass("hidden"),$(".no-more-loading").addClass("hidden");var t=$(this);t.hasClass("checked")?(t.children().first().removeClass("checked").addClass("unchecked"),t.removeClass("checked").addClass("unchecked")):(t.children().first().removeClass("unchecked").addClass("checked"),t.removeClass("unchecked").addClass("checked"));var o=[],i=[];$("#map-country-select .type-checkbox.checked").each(function(e,t){o.push($(t).attr("data-text")),console.log($(t).attr("data-text"))}),$("#map-energy-source-select .type-checkbox.checked").each(function(e,t){i.push($(t).attr("data-text")),console.log($(t).attr("data-text"))});for(var n in Statkraft.Markers)Statkraft.Markers[n].setVisible(-1==$.inArray(Statkraft.Markers[n].type,i)&&-1==$.inArray(Statkraft.Markers[n].country,o)?!1:!0);return g(),u(),!1}var e,t,a,o,i,n,r,s,p,c=8,l=function(){return javascriptEnabled(),Statkraft.mapSettings&&Statkraft.mapSettings.points&&0!=Statkraft.mapSettings.points.length&&0!=$("#BigMap").length?(v(),y(),w(),k(),u(),f(),$(".type-checkbox").click(x),g(),m(),void toggleMobileFilterMenu()):void $("#BigMap").addClass("hidden")};javascriptEnabled=function(){$(".jsdisabled").remove(),$(".jsenabled").show().removeClass("jsenabled")},toggleMobileFilterMenu=function(){$(".mobile-filter-menu").click(function(){$(this).toggleClass("open")})},toggleMobileExerpts=function(){$(".project-item .header .marker").off().on("click",function(e){e.stopPropagation(),e.preventDefault(),$(this).parents(".project-item").toggleClass("open")})},$(document).ready(function(){$(".dropdown-header").click(function(){$(this).closest(".select-map-options-box").find(".map-dropdown").toggle(),$(this).toggleClass("expanded")});var e=[],t=[],a="";$.each(Statkraft.mapProjects,function(o,i){e.push(i.MapProjectName),a=i.MapProjectCountry,-1==$.inArray(a,t)&&(t.push(a),$("#map-country-select .map-dropdown").append('<li class="checkbox-item"><a type="'+a+'" href="http://statkraft.com/about-statkraft/Projects/#" data-text="'+a+'"></a></li>'))}),$(".map-search").typeahead({hint:!0,highlight:!0,minLength:1},{name:"plants",displayKey:"value",source:b(e)}),$(".map-search").bind("typeahead:selected",function(e,t){console.log(t.value),$.each(Statkraft.mapProjects,function(e,a){a.MapProjectName==t.value&&(window.location=a.MapProjectUrl)})})});var b=function(e){return function(t,a){var o;o=[],substrRegex=new RegExp(t,"i"),$.each(e,function(e,t){substrRegex.test(t)&&o.push({value:t})}),console.log("Anropar rendermetoden..."),g(),a(o)}};return{initMap:l}}();